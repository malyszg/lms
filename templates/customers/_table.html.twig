{% if customers is empty %}
<div class="text-center py-5">
    <i class="bi bi-people text-muted" style="font-size: 3rem;"></i>
    <h5 class="text-muted mt-3">Brak klientów</h5>
    <p class="text-muted">Nie znaleziono klientów spełniających kryteria wyszukiwania.</p>
</div>
{% else %}
<div class="table-responsive">
    <table class="table table-hover">
        <thead class="table-light">
            <tr>
                <th>
                    <a href="#" 
                       class="text-decoration-none text-dark"
                       hx-get="/customers/table"
                       hx-vals='{"sort": "id", "order": "{{ filters.sort == "id" and filters.order == "asc" ? "desc" : "asc" }}"}'
                       hx-include="#customer-filters-form"
                       hx-target="#table-container"
                       hx-push-url="true">
                        ID
                        {% if filters.sort == "id" %}
                            <i class="bi bi-arrow-{{ filters.order == "asc" ? "up" : "down" }} ms-1"></i>
                        {% endif %}
                    </a>
                </th>
                <th>
                    <a href="#" 
                       class="text-decoration-none text-dark"
                       hx-get="/customers/table"
                       hx-vals='{"sort": "email", "order": "{{ filters.sort == "email" and filters.order == "asc" ? "desc" : "asc" }}"}'
                       hx-include="#customer-filters-form"
                       hx-target="#table-container"
                       hx-push-url="true">
                        Email
                        {% if filters.sort == "email" %}
                            <i class="bi bi-arrow-{{ filters.order == "asc" ? "up" : "down" }} ms-1"></i>
                        {% endif %}
                    </a>
                </th>
                <th>
                    <a href="#" 
                       class="text-decoration-none text-dark"
                       hx-get="/customers/table"
                       hx-vals='{"sort": "phone", "order": "{{ filters.sort == "phone" and filters.order == "asc" ? "desc" : "asc" }}"}'
                       hx-include="#customer-filters-form"
                       hx-target="#table-container"
                       hx-push-url="true">
                        Telefon
                        {% if filters.sort == "phone" %}
                            <i class="bi bi-arrow-{{ filters.order == "asc" ? "up" : "down" }} ms-1"></i>
                        {% endif %}
                    </a>
                </th>
                <th>Imię i Nazwisko</th>
                <th>
                    <a href="#" 
                       class="text-decoration-none text-dark"
                       hx-get="/customers/table"
                       hx-vals='{"sort": "leads_count", "order": "{{ filters.sort == "leads_count" and filters.order == "asc" ? "desc" : "asc" }}"}'
                       hx-include="#customer-filters-form"
                       hx-target="#table-container"
                       hx-push-url="true">
                        Liczba leadów
                        {% if filters.sort == "leads_count" %}
                            <i class="bi bi-arrow-{{ filters.order == "asc" ? "up" : "down" }} ms-1"></i>
                        {% endif %}
                    </a>
                </th>
                <th>
                    <a href="#" 
                       class="text-decoration-none text-dark"
                       hx-get="/customers/table"
                       hx-vals='{"sort": "created_at", "order": "{{ filters.sort == "created_at" and filters.order == "asc" ? "desc" : "asc" }}"}'
                       hx-include="#customer-filters-form"
                       hx-target="#table-container"
                       hx-push-url="true">
                        Data utworzenia
                        {% if filters.sort == "created_at" %}
                            <i class="bi bi-arrow-{{ filters.order == "asc" ? "up" : "down" }} ms-1"></i>
                        {% endif %}
                    </a>
                </th>
                <th class="text-center">Akcje</th>
            </tr>
        </thead>
        <tbody>
            {% for customer in customers %}
            <tr>
                <td>
                    <span class="badge bg-secondary">#{{ customer.id }}</span>
                </td>
                <td>
                    <div class="d-flex align-items-center">
                        <i class="bi bi-envelope me-2 text-muted"></i>
                        <span class="text-truncate" style="max-width: 200px;" title="{{ customer.email }}">
                            {{ customer.email }}
                        </span>
                    </div>
                </td>
                <td>
                    <div class="d-flex align-items-center">
                        <i class="bi bi-telephone me-2 text-muted"></i>
                        <span>{{ customer.phone }}</span>
                    </div>
                </td>
                <td>
                    {% if customer.firstName or customer.lastName %}
                        <div class="d-flex align-items-center">
                            <i class="bi bi-person me-2 text-muted"></i>
                            <span>
                                {% if customer.firstName %}{{ customer.firstName }}{% endif %}
                                {% if customer.lastName %} {{ customer.lastName }}{% endif %}
                            </span>
                        </div>
                    {% else %}
                        <span class="text-muted">-</span>
                    {% endif %}
                </td>
                <td>
                    <span class="badge bg-info">
                        <i class="bi bi-list-ul me-1"></i>
                        {{ customer.leadsCount ?? 0 }}
                    </span>
                </td>
                <td>
                    <div class="d-flex align-items-center">
                        <i class="bi bi-calendar me-2 text-muted"></i>
                        <span>{{ customer.createdAt|date('d.m.Y H:i') }}</span>
                    </div>
                </td>
                <td class="text-center">
                    <button type="button" 
                            class="btn btn-outline-primary btn-sm"
                            onclick="openCustomerDetails({{ customer.id }})"
                            title="Szczegóły">
                        <i class="bi bi-eye"></i>
                    </button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Pagination -->
{% if pagination.lastPage > 1 %}
<nav aria-label="Paginacja klientów" class="mt-3">
    <ul class="pagination justify-content-center">
        <!-- Previous Page -->
        {% if pagination.hasPrevious %}
        <li class="page-item">
            <a class="page-link" 
               href="#"
               hx-get="/customers/table"
               hx-vals='{"page": "{{ pagination.currentPage - 1 }}"}'
               hx-include="#customer-filters-form"
               hx-target="#table-container"
               hx-push-url="true">
                <i class="bi bi-chevron-left"></i>
                Poprzednia
            </a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <span class="page-link">
                <i class="bi bi-chevron-left"></i>
                Poprzednia
            </span>
        </li>
        {% endif %}

        <!-- Page Numbers -->
        {% set startPage = max(1, pagination.currentPage - 2) %}
        {% set endPage = min(pagination.lastPage, pagination.currentPage + 2) %}

        {% if startPage > 1 %}
        <li class="page-item">
            <a class="page-link" 
               href="#"
               hx-get="/customers/table"
               hx-vals='{"page": "1"}'
               hx-include="#customer-filters-form"
               hx-target="#table-container"
               hx-push-url="true">1</a>
        </li>
        {% if startPage > 2 %}
        <li class="page-item disabled">
            <span class="page-link">...</span>
        </li>
        {% endif %}
        {% endif %}

        {% for page in startPage..endPage %}
        <li class="page-item {{ page == pagination.currentPage ? 'active' : '' }}">
            {% if page == pagination.currentPage %}
            <span class="page-link">{{ page }}</span>
            {% else %}
            <a class="page-link" 
               href="#"
               hx-get="/customers/table"
               hx-vals='{"page": "{{ page }}"}'
               hx-include="#customer-filters-form"
               hx-target="#table-container"
               hx-push-url="true">{{ page }}</a>
            {% endif %}
        </li>
        {% endfor %}

        {% if endPage < pagination.lastPage %}
        {% if endPage < pagination.lastPage - 1 %}
        <li class="page-item disabled">
            <span class="page-link">...</span>
        </li>
        {% endif %}
        <li class="page-item">
            <a class="page-link" 
               href="#"
               hx-get="/customers/table"
               hx-vals='{"page": "{{ pagination.lastPage }}"}'
               hx-include="#customer-filters-form"
               hx-target="#table-container"
               hx-push-url="true">{{ pagination.lastPage }}</a>
        </li>
        {% endif %}

        <!-- Next Page -->
        {% if pagination.hasNext %}
        <li class="page-item">
            <a class="page-link" 
               href="#"
               hx-get="/customers/table"
               hx-vals='{"page": "{{ pagination.currentPage + 1 }}"}'
               hx-include="#customer-filters-form"
               hx-target="#table-container"
               hx-push-url="true">
                Następna
                <i class="bi bi-chevron-right"></i>
            </a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <span class="page-link">
                Następna
                <i class="bi bi-chevron-right"></i>
            </span>
        </li>
        {% endif %}
    </ul>
</nav>

<!-- Pagination Info -->
<div class="text-center text-muted mt-2">
    <small>
        Wyświetlane {{ pagination.from }} - 
        {{ pagination.to }} 
        z {{ pagination.total }} klientów
    </small>
</div>
{% endif %}
{% endif %}
