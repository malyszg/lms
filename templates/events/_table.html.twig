{% if events is empty %}
    <div style="padding: 2rem; text-align: center;">
        <i class="bi bi-info-circle text-info" style="font-size: 3rem;"></i>
        <p class="mt-3">Nie znaleziono eventów spełniających kryteria filtrowania.</p>
        <a href="{{ path('events_index') }}" class="btn btn-primary btn-sm">Pokaż wszystkie eventy</a>
    </div>
{% else %}
    <div style="overflow-x: auto;">
        <table class="table table-hover">
            <thead class="table-light">
                <tr>
                    <th style="width: 50px;">ID</th>
                    <th style="width: 150px;">Typ eventu</th>
                    <th style="width: 120px;">Encja</th>
                    <th style="width: 100px;">Użytkownik</th>
                    <th style="width: 120px;">IP</th>
                    <th style="width: 150px;">Data i czas</th>
                    <th style="width: 100px;">Szczegóły</th>
                </tr>
            </thead>
            <tbody>
                {% for event in events %}
                    <tr>
                        <td>{{ event.id }}</td>
                        <td>
                            {% set iconClass = 'bi-info-circle text-info' %}
                            {% if event.eventType in ['lead_created', 'cdp_delivery_success', 'login_attempt'] %}
                                {% set iconClass = 'bi-check-circle text-success' %}
                            {% elseif event.eventType in ['cdp_delivery_failed', 'lead_deleted'] %}
                                {% set iconClass = 'bi-x-circle text-danger' %}
                            {% elseif event.eventType in ['lead_updated', 'customer_preferences_changed'] %}
                                {% set iconClass = 'bi-pencil text-warning' %}
                            {% endif %}
                            <span class="badge bg-light text-dark">
                                <i class="bi {{ iconClass }}"></i>
                                {{ event.eventType|replace({'_': ' '})|title }}
                            </span>
                        </td>
                        <td>
                            {% if event.entityType and event.entityId %}
                                <code>{{ event.entityType }}#{{ event.entityId }}</code>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if event.userId %}
                                <span class="badge bg-secondary">{{ event.userId }}</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if event.ipAddress %}
                                <code style="font-size: 0.85rem;">{{ event.ipAddress }}</code>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            <small>{{ event.createdAt|date('d.m.Y H:i:s') }}</small>
                        </td>
                        <td>
                            {% if event.details %}
                                <button class="btn btn-sm btn-link p-0" 
                                        type="button" 
                                        data-bs-toggle="collapse" 
                                        data-bs-target="#event-details-{{ event.id }}"
                                        aria-expanded="false">
                                    <i class="bi bi-chevron-down"></i> Pokaż
                                </button>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% if event.details %}
                        <tr>
                            <td colspan="7" class="p-0 border-top-0">
                                <div class="collapse" id="event-details-{{ event.id }}">
                                    <div class="card card-body bg-light" style="border: none; border-radius: 0;">
                                        <h6 class="mb-3">
                                            <i class="bi bi-info-circle me-2"></i>
                                            Szczegóły eventu #{{ event.id }}
                                        </h6>
                                        <pre class="bg-white p-3 rounded" style="max-height: 400px; overflow: auto; font-size: 0.85rem;"><code>{{ event.details|json_encode(constant('JSON_PRETTY_PRINT')|default(4)) }}</code></pre>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    {% endif %}
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    <nav aria-label="Paginacja" class="p-3">
        <ul class="pagination justify-content-center mb-0">
            {% if pagination.hasPrevious %}
                <li class="page-item">
                    <a class="page-link" 
                       href="{{ path('events_index', app.request.query.all|merge({page: pagination.currentPage - 1})) }}">
                        Poprzednia
                    </a>
                </li>
            {% else %}
                <li class="page-item disabled">
                    <span class="page-link">Poprzednia</span>
                </li>
            {% endif %}

            {% for i in range(max(1, pagination.currentPage - 2), min(pagination.lastPage, pagination.currentPage + 2)) %}
                <li class="page-item {% if i == pagination.currentPage %}active{% endif %}">
                    <a class="page-link" 
                       href="{{ path('events_index', app.request.query.all|merge({page: i})) }}">
                        {{ i }}
                    </a>
                </li>
            {% endfor %}

            {% if pagination.hasNext %}
                <li class="page-item">
                    <a class="page-link" 
                       href="{{ path('events_index', app.request.query.all|merge({page: pagination.currentPage + 1})) }}">
                        Następna
                    </a>
                </li>
            {% else %}
                <li class="page-item disabled">
                    <span class="page-link">Następna</span>
                </li>
            {% endif %}
        </ul>
        
        <div class="text-center mt-2">
            <small class="text-muted">
                Wyświetlanie {{ pagination.from }} - {{ pagination.to }} z {{ pagination.total }} eventów
            </small>
        </div>
    </nav>
{% endif %}

